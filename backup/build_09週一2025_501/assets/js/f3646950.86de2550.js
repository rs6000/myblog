"use strict";(self.webpackChunkmyblog=self.webpackChunkmyblog||[]).push([[792],{8453:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>l});var s=r(6540);const i={},t=s.createContext(i);function o(n){const e=s.useContext(t);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),s.createElement(t.Provider,{value:e},n.children)}},9440:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"iThome_2021/iThome_2021_Day11","title":"\u6587\u7ae0\u6a19\u984c DAY 11","description":"\u521d\u7a3f\u6642\u9593 2021-09-04","source":"@site/docs/iThome_2021/iThome_2021_Day11.md","sourceDirName":"iThome_2021","slug":"/iThome_2021/iThome_2021_Day11","permalink":"/myblog/docs/iThome_2021/iThome_2021_Day11","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/iThome_2021/iThome_2021_Day11.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"\u6587\u7ae0\u6a19\u984c DAY 10","permalink":"/myblog/docs/iThome_2021/iThome_2021_Day10"},"next":{"title":"\u6587\u7ae0\u6a19\u984c DAY 12","permalink":"/myblog/docs/iThome_2021/iThome_2021_Day12"}}');var i=r(4848),t=r(8453);const o={sidebar_position:11},l="\u6587\u7ae0\u6a19\u984c DAY 11",d={},c=[{value:"\u521d\u7a3f\u6642\u9593 2021-09-04",id:"\u521d\u7a3f\u6642\u9593-2021-09-04",level:5},{value:"\u524d\u8a00",id:"\u524d\u8a00",level:3},{value:"\u7533\u8acb Line Developer \u5e33\u865f",id:"\u7533\u8acb-line-developer-\u5e33\u865f",level:3},{value:"\u4fdd\u5b58LineBot \u7684\u91cd\u8981\u8cc7\u6599",id:"\u4fdd\u5b58linebot-\u7684\u91cd\u8981\u8cc7\u6599",level:3},{value:"LineBot \u958b\u767c\u74b0\u5883\u5efa\u7f6e (for Python)",id:"linebot-\u958b\u767c\u74b0\u5883\u5efa\u7f6e-for-python",level:3},{value:"\u6e2c\u8a66LineBot",id:"\u6e2c\u8a66linebot",level:3},{value:"tags: <code>13th\u9435\u4eba\u8cfd</code> <code>\u4e2d\u5e74\u5927\u53d4</code> <code>\u842c\u5e74\u83dc\u96de</code> <code>\u8d70\u4e0d\u51fa\u65b0\u624b\u6751</code> <code>\u81ea\u5b78\u6b77\u7a0b</code>",id:"tags-13th\u9435\u4eba\u8cfd-\u4e2d\u5e74\u5927\u53d4-\u842c\u5e74\u83dc\u96de-\u8d70\u4e0d\u51fa\u65b0\u624b\u6751-\u81ea\u5b78\u6b77\u7a0b",level:6}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h3:"h3",h5:"h5",h6:"h6",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"\u6587\u7ae0\u6a19\u984c-day-11",children:"\u6587\u7ae0\u6a19\u984c DAY 11"})}),"\n",(0,i.jsx)(e.h5,{id:"\u521d\u7a3f\u6642\u9593-2021-09-04",children:"\u521d\u7a3f\u6642\u9593 2021-09-04"}),"\n",(0,i.jsx)(e.h1,{id:"\u7b2c\u4e00\u500b\u5c0f\u7bc4\u4f8b--linebot-\u81ea\u52d5\u56de\u8a71",children:"\u7b2c\u4e00\u500b\u5c0f\u7bc4\u4f8b : LineBot \u81ea\u52d5\u56de\u8a71"}),"\n",(0,i.jsx)(e.h3,{id:"\u524d\u8a00",children:"\u524d\u8a00"}),"\n",(0,i.jsx)(e.p,{children:"\u4eca\u5929\u662f\u9435\u4eba\u8cfd\u7684\u7b2c\u5341\u4e00\u5929\uff0c\u958b\u59cb\u9032\u5165\u65b0\u7684\u968e\u6bb5\u5566\r\n\u5f9e\u9019\u908a\u958b\u59cb\u6703\u5beb\u4e00\u4e9b\u6211\u81ea\u5b78\u904e\u7a0b\u4e2d\u5beb\u904e\u7684\u7bc4\u4f8b"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://i.imgur.com/uMHnELF.png",alt:"Imgur"})}),"\n",(0,i.jsx)(e.h3,{id:"\u7533\u8acb-line-developer-\u5e33\u865f",children:"\u7533\u8acb Line Developer \u5e33\u865f"}),"\n",(0,i.jsxs)(e.p,{children:["\u8981\u958b\u59cb\u5bebLine Bot\u4e4b\u524d\uff0c\u5148\u8981\u6709Line\u958b\u767c\u8005\u5e33\u865f\r\n\u8acb\u5148\u5230",(0,i.jsx)(e.a,{href:"https://developers.line.biz/console/",children:"LINE Developers Console"})," \u5efa\u7acb\u4e00\u500b\u958b\u767c\u8005\u5e33\u865f\r\n(\u8a3b: \u8981\u5275\u7acb\u958b\u767c\u8005\u5e33\u865f\u4e4b\u524d...\u8981\u5148\u6709Line\u7684\u5e33\u865f)"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u4e0d\u77e5\u77e5\u9053\u600e\u9ebc\u8a3b\u518a\u958b\u767c\u8005\u5e33\u865f\uff0c\u8acb\u9ede\u9078\u4e0b\u9762\u7684\u5716\u7247\u9023\u7d50\r\n",(0,i.jsx)(e.a,{href:"https://developers.line.biz/zh-hant/docs/messaging-api/getting-started/",children:(0,i.jsx)(e.img,{src:"https://i.imgur.com/7U8zDEP.png",alt:"Imgur"})})]}),"\n",(0,i.jsxs)(e.p,{children:["\u5efa\u597d\u958b\u767c\u8005\u5e33\u865f\u5f8c\uff0c\u5c31\u5728\u7ba1\u7406\u9801\u9762\u4e0a\u5efa\u7acb\u4e00\u500b ",(0,i.jsx)(e.strong,{children:"provider"}),"\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/cBy6hzE.png",alt:"Imgur"}),"\r\n\u5728\u5efa\u7acb\u7684\u985e\u578b\u9078\u64c7 ",(0,i.jsx)(e.strong,{children:"Create Messaging API channel"}),"\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/jxgOwlw.png",alt:"Imgur"}),"\r\n\u4e4b\u5f8c\u5c31\u7167\u8457\u586b\u8cc7\u6599\uff0c\u4e0b\u9762\u7684\u5716\u5c31\u662f\u6211\u5efa\u597d\u7684 (\u8c6c\u982d\u53ef\u4ee5\u63db\u6210\u81ea\u5df1\u559c\u6b61\u7684\u5716..)\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/aFqxGD0.png",alt:"Imgur"})]}),"\n",(0,i.jsx)(e.h3,{id:"\u4fdd\u5b58linebot-\u7684\u91cd\u8981\u8cc7\u6599",children:"\u4fdd\u5b58LineBot \u7684\u91cd\u8981\u8cc7\u6599"}),"\n",(0,i.jsx)(e.p,{children:"Line Bot\u7684\u5e33\u865f\u5efa\u597d\u4e4b\u5f8c\uff0c\u6709\u5169\u500b\u8cc7\u6599\u8981\u5148\u4fdd\u5b58"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Channel secret"}),"\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/VC5t4bH.png",alt:"Imgur"}),"\r\n",(0,i.jsx)(e.strong,{children:"Channel access token"}),"\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/5HdIJy2.png",alt:"Imgur"}),"\r\n\u4e0a\u9762\u7684\u5169\u5f35\u5716\uff0c\u7d05\u8272\u6846\u8d77\u4f86\u7684\u90e8\u5206\uff0c\u628a\u6587\u5b57\u8907\u88fd\u4e0b\u4f86\uff0c\u8cbc\u5728\u8a18\u4e8b\u672c\u88e1\u4fdd\u5b58\r\n\u5728\u672c\u6a5f\u958b\u767cLien Bot\u6642\uff0c\u6703\u7528\u5230\uff0c\u5b58\u4e0b\u4f86\u5c31\u4e0d\u7528\u53bb\u958b\u7db2\u9801\u67e5\u770b\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u88dc\u5145: \u6700\u5f8c\u8a18\u5f97\u8981\u628a\u9019\u500bLineBot \u52a0\u5230\u4f60\u7684Line\u597d\u53cb"})}),"\n",(0,i.jsx)(e.h3,{id:"linebot-\u958b\u767c\u74b0\u5883\u5efa\u7f6e-for-python",children:"LineBot \u958b\u767c\u74b0\u5883\u5efa\u7f6e (for Python)"}),"\n",(0,i.jsx)(e.p,{children:"\u4ee5\u4e0b\u90fd\u662f\u5728win10 64bit \u5bb6\u7528\u7248\u7684\u74b0\u5883\u4e0b\u5efa\u7f6e"}),"\n",(0,i.jsxs)(e.p,{children:["\u4e0b\u8f09",(0,i.jsx)(e.a,{href:"https://ngrok.com/download",children:"Ngrok"})]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"\u9019\u662f\u4e00\u500b\u53ef\u5728\u672c\u5730\u7aef\u6e2c\u8a66webhook \u7684\u5fc5\u5099\u5de5\u5177"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5b89\u88ddPython \u865b\u64ec\u74b0\u5883\u7684\u5957\u4ef6\r\n",(0,i.jsx)(e.code,{children:"pip install virtualenvwrapper-win"})]}),"\n",(0,i.jsx)(e.p,{children:"\u5efa\u7acb Python \u865b\u64ec\u74b0\u5883"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ptyhon",children:"mkvirtualenv mylinebot\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5efa\u7acb LineBot \u958b\u767c\u5c08\u6848"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"#\u8a3b: \u4ee5\u4e0b\u64cd\u4f5c\u90fd\u9700\u8981\u5728python\u7684\u865b\u64ec\u74b0\u5883\u5e95\u4e0b\u57f7\u884c\r\n#\u5b89\u88dd Django & Line SDK\r\npip install Django==2.2.4\r\npip install line-bot-sdk==1.8.0\r\npip install yfinance\r\n\r\n#\u5efa\u7acb django \u5c08\u6848\r\ndjango-admin starproject mybot\r\ncd mybot\r\n\r\n#\u5efa\u7acb app \u8ddf \u8cc7\u6599\u5eab\u521d\u59cb\u5316\r\npython manage.py startapp myapp\r\npython manage.py makemigrations\r\npython manage.py migrate\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5728\u9019\u500b\u7bc4\u4f8b\u88e1\u53ea\u6703\u4fee\u65393\u96bb\u6a94\u6848\u5982\u4e0b\u5716\u6240\u793a:\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/stlVP1H.png",alt:"Imgur"})]}),"\n",(0,i.jsx)(e.p,{children:"/settings.py \u8a2d\u5b9a\u6a94\u5167\u5bb9\u592a\u9577\uff0c\u53ea\u5217\u51fa\u8981\u6539\u7684\u5730\u65b9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"#\u627e\u5230ALLOWED_HOSTS \u628a\u5167\u5bb9\u6539\u6210 ['*']\r\nALLOWED_HOSTS = ['*']\r\n\r\n#\u6a94\u6848\u6700\u5f8c\u9762\u52a0\u5165\r\nLINE_CHANNEL_SECRET ='\u9019\u908a\u6539\u6210\u4f60\u7533\u8acb\u7684' \r\nLINE_CHANNEL_ACCESS_TOKEN ='\u9019\u908a\u6539\u6210\u4f60\u7533\u8acb\u7684'\r\n\n"})}),"\n",(0,i.jsx)(e.p,{children:"/urls.py"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"from django.contrib import admin\r\nfrom django.urls import path\r\nfrom django.conf.urls import url\r\nfrom myapp import views\r\n\r\nurlpatterns = [\r\n    url('^callback',views.callback),\r\n    path('admin/', admin.site.urls),\r\n]\n"})}),"\n",(0,i.jsx)(e.p,{children:"/views.py"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"from django.conf import settings\r\nfrom django.http import HttpResponse, HttpResponseBadRequest, HttpResponseForbidden\r\nfrom django.views.decorators.csrf import csrf_exempt\r\n\r\nfrom linebot import LineBotApi, WebhookParser\r\nfrom linebot.exceptions import InvalidSignatureError, LineBotApiError\r\nfrom linebot.models import MessageEvent, TextSendMessage\r\nfrom module import func\r\n\r\n\r\nline_bot_api = LineBotApi(settings.LINE_CHANNEL_ACCESS_TOKEN)\r\nparser = WebhookParser(settings.LINE_CHANNEL_SECRET)\r\n\r\n\r\n\r\n#\u50b3\u4ec0\u9ebc\u8a0a\u606f\u56de\u8986\u76f8\u540c\u8a0a\u606f\u7684\u7bc4\u4f8b\r\n@csrf_exempt\r\ndef callback(request):\r\n    if request.method == 'POST':\r\n        signature = request.META['HTTP_X_LINE_SIGNATURE']\r\n        body = request.body.decode('utf-8')\r\n\r\n        try:\r\n            events = parser.parse(body, signature)\r\n        except InvalidSignatureError:\r\n            return HttpResponseForbidden()\r\n        except LineBotApiError:\r\n            return HttpResponseBadRequest()\r\n\r\n        for event in events:\r\n            if isinstance(event, MessageEvent):\r\n                line_bot_api.reply_message(event.reply_token,TextSendMessage(text=event.message.text))\r\n\r\n        return HttpResponse()\r\n    else:\r\n        return HttpResponseBadRequest()\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4ee5\u4e0a\u7684\u7a0b\u5f0f\u78bc\u5167\u5bb9\uff0c\u53ea\u8981\u8907\u88fd\u8cbc\u4e0a\uff0c\u57fa\u672c\u4e0a\u90fd\u53ef\u4ee5\u6b63\u78ba\u5730\u57f7\u884c\r\n\u9019\u500b\u662fLine Bot\u6700\u7c21\u55ae\u7684Echo\u7bc4\u4f8b\uff0c\u4e5f\u662fLine\u5b98\u7db2\u4e0a\u9762\u7684\u7bc4\u4f8b(\u53c8\u53ef\u7a31\u70ba\u516c\u7248\u7a0b\u5f0f)\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/2dbW80v.png",alt:"Imgur"}),"\r\n(\u8a3b",":Line","\u5b98\u7db2\u7684python\u7bc4\u4f8b\u662f\u4ee5\u53e6\u4e00\u500b\u6846\u67b6Flask\u70ba\u4f8b\uff0c\u9019\u908a\u662f\u7528Django)"]}),"\n",(0,i.jsx)(e.h3,{id:"\u6e2c\u8a66linebot",children:"\u6e2c\u8a66LineBot"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"python manage.py runserver\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://i.imgur.com/Gp45G9O.png",alt:"Imgur"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6253\u958b ngrok\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/rXJ4t7V.png",alt:"Imgur"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u628a ngrok\u7684\u7db2\u5740 \u586b\u5230 LineBot \u7684\u7ba1\u7406\u9801\u9762\u4e0a\r\n",(0,i.jsx)(e.strong,{children:'\u88dc\u5145: "\u6bcf\u6b21" \u6253\u958bngrok \u5f97\u5230\u7684\u7db2\u5740\u90fd\u4e0d\u4e00\u6a23\uff0c\u6bcf\u6b21\u90fd\u8981\u53bbLineBot\u7684\u7ba1\u7406\u9801\u9762\u66f4\u63dbWebhook URL'}),"\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/MySmITy.png",alt:"Imgur"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u6253\u958bLine \u50b3\u7d66\u8a0a\u606f\u7d66Bot\r\n",(0,i.jsx)(e.img,{src:"https://i.imgur.com/ComeoOo.png",alt:"Imgur"})]}),"\n",(0,i.jsx)(e.p,{children:"\u4e0b\u8f09\u672c\u7bc7\u7684\u7bc4\u4f8b\u7a0b\u5f0f\u78bc (\u4f7f\u7528git clone)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"git clone https://smilehsu@bitbucket.org/smilehsu/mylinebot.git\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4ee5\u4e0a\u5c31\u662f\u9435\u4eba\u8cfd\u7b2c11\u5929\u7684\u5167\u5bb9 :)"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.p,{children:"\u53c3\u8003\u8cc7\u6599\u8207\u76f8\u95dc\u9023\u7d50:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"sdsd"}),"\n",(0,i.jsx)(e.li,{children:"sdsa"}),"\n",(0,i.jsx)(e.li,{children:"dsadsa"}),"\n",(0,i.jsx)(e.li,{children:"asdsad"}),"\n",(0,i.jsx)(e.li,{children:"sadsad"}),"\n",(0,i.jsx)(e.li,{children:"sadsad"}),"\n",(0,i.jsx)(e.li,{children:"sadsad"}),"\n",(0,i.jsx)(e.li,{children:"sadsad"}),"\n",(0,i.jsx)(e.li,{children:"sadsad"}),"\n",(0,i.jsx)(e.li,{children:"adsad"}),"\n",(0,i.jsx)(e.li,{children:"asd"}),"\n",(0,i.jsx)(e.li,{}),"\n"]}),"\n",(0,i.jsxs)(e.h6,{id:"tags-13th\u9435\u4eba\u8cfd-\u4e2d\u5e74\u5927\u53d4-\u842c\u5e74\u83dc\u96de-\u8d70\u4e0d\u51fa\u65b0\u624b\u6751-\u81ea\u5b78\u6b77\u7a0b",children:["tags: ",(0,i.jsx)(e.code,{children:"13th\u9435\u4eba\u8cfd"})," ",(0,i.jsx)(e.code,{children:"\u4e2d\u5e74\u5927\u53d4"})," ",(0,i.jsx)(e.code,{children:"\u842c\u5e74\u83dc\u96de"})," ",(0,i.jsx)(e.code,{children:"\u8d70\u4e0d\u51fa\u65b0\u624b\u6751"})," ",(0,i.jsx)(e.code,{children:"\u81ea\u5b78\u6b77\u7a0b"})]})]})}function p(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(a,{...n})}):a(n)}}}]);